# =============================================================================
# Dockerfile.dev for DevOps Daily
# Development environment with hot-reload support
# =============================================================================

# Build arguments for version pinning
ARG NODE_VERSION=20.18.1
ARG PNPM_VERSION=10.11.1

FROM node:${NODE_VERSION}-bullseye-slim

ARG PNPM_VERSION

# Install security updates and pnpm with specific version
RUN apt-get update && \
    apt-get upgrade -y && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* && \
    corepack enable && \
    corepack prepare pnpm@${PNPM_VERSION} --activate

# Set working directory
WORKDIR /app

# Copy package files for dependency installation
COPY package.json pnpm-lock.yaml ./

# Install all dependencies (including devDependencies)
RUN pnpm install --frozen-lockfile

# Copy source files (will be overridden by volume mount in docker-compose)
COPY . .

# Set environment variables for development
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1

# Enable polling for file watching in Docker
# Needed for hot-reload on some systems (Windows, Mac, network mounts)
ENV WATCHPACK_POLLING=true

# Expose development port
EXPOSE 3000

# Start the development server
CMD ["pnpm", "run", "dev"]
